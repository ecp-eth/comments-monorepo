# Authentication Method Tracking Example

The Comments Protocol now tracks how each comment was authenticated on-chain. This provides transparency and enables new use cases for applications.

## Overview

Every comment includes an `authMethod` field that indicates how the comment was authenticated:

- **`0` (DIRECT_TX)** - User signed transaction directly
- **`1` (APP_APPROVAL)** - User pre-approved the app
- **`2` (AUTHOR_SIGNATURE)** - User signed comment hash

## Example: Building Trust Indicators

Here's how you might use authentication methods to show trust indicators in your UI:

```typescript
import { getComment } from '@ecp.eth/sdk';

function CommentTrustIndicator({ commentId }: { commentId: string }) {
  const comment = await getComment({ commentId });

    const getTrustLevel = (authMethod: number) => {
    switch (authMethod) {
      case 0: // DIRECT_TX
        return { level: 'high', label: 'Direct transaction', color: 'green' };
      case 1: // APP_APPROVAL
        return { level: 'medium', label: 'Pre-approved app', color: 'blue' };
      case 2: // AUTHOR_SIGNATURE
        return { level: 'high', label: 'User signed', color: 'green' };
      default:
        return { level: 'unknown', label: 'Unknown', color: 'gray' };
    }
  };

  const trust = getTrustLevel(comment.authMethod);

  return (
    <div className={`trust-indicator trust-${trust.color}`}>
      <span className="trust-dot"></span>
      {trust.label}
    </div>
  );
}
```

## Example: Analytics Dashboard

Track authentication method usage across your application:

```typescript
import { fetchComments } from "@ecp.eth/sdk/indexer";

async function getAuthMethodStats(targetUri: string) {
  const comments = await fetchComments({ targetUri });

  const stats = comments.reduce(
    (acc, comment) => {
      const methodNames = ["Direct TX", "App Approval", "User Signature"];
      const methodName = methodNames[comment.authMethod] || "Unknown";

      acc[methodName] = (acc[methodName] || 0) + 1;
      acc.total++;

      return acc;
    },
    { total: 0 } as Record<string, number>,
  );

  return stats;
}

// Usage
const stats = await getAuthMethodStats("https://example.com/post/123");
console.log("Authentication method distribution:", stats);
// Output: { 'Direct TX': 45, 'App Approval': 23, 'User Signature': 12, total: 80 }
```

## Example: Security Monitoring

Monitor for unusual authentication patterns:

```typescript
function detectSuspiciousActivity(comments: Comment[]) {
  const appApprovalComments = comments.filter((c) => c.authMethod === 1);

  // Flag if too many comments from the same app in short time
  const appCounts = appApprovalComments.reduce(
    (acc, comment) => {
      acc[comment.app] = (acc[comment.app] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>,
  );

  const suspiciousApps = Object.entries(appCounts)
    .filter(([app, count]) => count > 100) // More than 100 comments
    .map(([app]) => app);

  if (suspiciousApps.length > 0) {
    console.warn("Suspicious app activity detected:", suspiciousApps);
  }
}
```

## Event Listening

Listen for comment events and track authentication methods:

```typescript
import { watchCommentAdded } from "@ecp.eth/sdk";

// Listen for new comments and track auth methods
watchCommentAdded({
  onCommentAdded: (event) => {
    const authMethodNames = ["DIRECT_TX", "APP_APPROVAL", "AUTHOR_SIGNATURE"];
    const authMethod = authMethodNames[event.authMethod];

    console.log(`New comment ${event.commentId} created via ${authMethod}`);

    // Track in your analytics
    analytics.track("comment_created", {
      commentId: event.commentId,
      authMethod: authMethod,
      author: event.author,
      app: event.app,
    });
  },
});
```

## Benefits

Authentication method tracking enables:

1. **Enhanced Trust** - Users can see how comments were created
2. **Better UX** - Different flows can be highlighted appropriately
3. **Security** - Detect patterns that might indicate abuse
4. **Analytics** - Understand how users prefer to interact
5. **Compliance** - Audit trails for regulated applications

This feature provides transparency while maintaining the flexibility of the Comments Protocol's multi-signature architecture.
